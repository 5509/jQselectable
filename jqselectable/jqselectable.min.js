/*!
 * jQselectable
 *
 * @version      3.0
 * @author       nori (norimania@gmail.com)
 * @copyright    5509 (http://5509.me/)
 * @license      The MIT License
 * @link         https://github.com/5509/jQselectable
 *
 * 2012-04-10 00:00
 */(function(a,b,c,d){function g(a,b){var c=0,d=a.length;for(;c<d;c+=1)b(c,a[c])}function h(){return c.documentElement.scrollTop||c.body.scrollTop}function i(){return c.documentElement.clientHeight||c.body.clientHeight}var e={},f=function(a,b){this.namespace="jQselectable";if(!(this instanceof f))return new f(a,b);this.init(a,b)};f.prototype={init:function(b,f){var g=this,f=g.conf=a.extend({style:"selectable",showDuration:150,hideDuration:150,show:"fadeIn",hide:"fadeOut",height:"auto",top:0,left:0,opacity:.9},f);g.elem=b;g.$elem=a(b);g.$body=a("body");g.$document=a(c);g.state=!1;g.map={};g.selected=d;g.selected_id=d;g.has_no_maxheight=typeof c.body.style.maxHeight;g.id=g.elem.id||"jqs_"+parseInt(Math.random()*1e3);e[g.id]=g;g.attr={id:g.id,klass:g.elem.className};g.style=/simple/.test(f.style)?"sBox":"sctble";g._build();g._eventify()},_map:function(){var a=this;a.$option=a.$elem.find("option");g(a.$option,function(b,c){var d=c.value;a.map[d.length?d:"nodata"]={elem:c,text:c.textContent||c.innerText}})},_build:function(){var a=this,b=a.conf,e=a.$elem.val(),f=a.id,g=d,h=a.$body,i=a.$elem;e=e.length?e:"nodata";a._map();a.$view=a._view(a.map[e].text).addClass(a.style).addClass(a.attr.klass);a.$list=a._createList().css({position:"absolute"});i.hide().after(a.$view);h.append(a.$list);a.list_height=a.$list[0].offsetHeight;g=a.selected_id;a.selected=c.getElementById(f+"_"+g);a.$list.hide()},_view:function(b){var c=this;return a(['<a id="'+c.id+'_dammy"','href="javascript:void(0)"','class="sctble_display"','data-id="'+c.id+'"',">",'<span data-id="'+c.id+'">',b,"</span>","</a>"].join(""))},_setPosition:function(){var a=this,b=a.conf,c=a.$view,e=a.$list,f=d,g=c.offset(),j=h(),k=i();k/2<g.top-j?f=g.top-a.list_height+b.top-5:f=g.top+c.height()*1.3+b.top;e.css({top:f,left:g.left+b.left})},_addSelected:function(a){var b=this;b.selected=a;a.className="selected"},_removeSelected:function(){var a=this,b=a.selected;if(!b)return;b.className=""},_addItem:function(a,b){var c=this;g(b,function(b,d){var e=d.value||"nodata",f=c.map[e].text,g=d.className,h=d.selected;h&&(c.selected_id=e);a+=d.disabled?"<span>":['<a href="#'+f+'"','id="'+c.id+"_"+e+'"','data-value="'+e+'"',h?'class="selected"':"",">"].join("");a+=f;a+=d.disabled?"</span>":"</a>";g&&/br/.test(g)&&(a+="<br>")});c.selected_id||(c.selected_id=b[0].value);return a},_createList:function(){var b=this,c=b.conf,e=d,f=b.id+"_mat",h="sctble_mat "+b.attr.klass,i='<div id="'+f+'" class="'+h+'">',j=c.height==="auto"?"auto":c.height+"px",k=b.$elem;b.has_no_maxheight?e="height: "+j+"; overflow-y: scroll;":e="max-height: "+j+";";i=i+'<div class="body" style="'+e+'">';b.has_group=k.find("optgroup").length;if(b.has_group){b.list_klass="sctble optgroup";i+=function(){var a="<dl>",c=k.find("optgroup");g(c,function(c,d){var e=d.getElementsByTagName("option");a+="<dt>"+d.label+"</dt><dd>";a=b._addItem(a,e);a+="</dd>"});a+="</dl>";return a}()}else{c.style==="selectable"?b.list_klass="sctble nooptgroup":b.list_klass="sBox nooptgroup";i+=function(){var a="";a=b._addItem(a,b.$option);return a}()}i+="</div></div>";return a(i).addClass(b.list_klass)},_eventify:function(){var a=this,b=a.$elem,c=a.$view,d=a.$list;c.bind("click",function(){if(a.disabled)return;b.trigger("jQselectable.click")});d.delegate("a","click",function(a){var c=this;a.preventDefault();b.trigger("jQselectable.change",{value:c.getAttribute("data-value"),anchor:c})});b.bind("jQselectable.click",function(b){a._show()});b.bind("jQselectable.change",function(b,c){a._change(c.value);a._removeSelected();a._addSelected(c.anchor);a.$view.focus()})},_show:function(){var a=this,b=a.conf,c=a.$list,e=a.$view,f=d,g=d,j=d,k=d;a._setPosition();a.state=!0;if(b.show==="slideDown"){f=h();g=i();j=e.offset();k=g/2<j.top-f;if(k){c.css({top:j.top+b.top-5});c.animate({height:"toggle",top:parseInt(c.css("top"))-a.list_height},{easing:"swing",duration:b.showDuration}).css({opacity:b.opacity})}else c.slideDown(b.showDuration).css({opacity:b.opacity})}else b.show==="fadeIn"?c.css({display:"block",opacity:0}).fadeTo(b.showDuration,b.opacity):c.show().css({opacity:b.opacity});setTimeout(function(){a.selected.focus()},isNaN(b.showDuration)?function(){var a=b.showDuration;return/slow/.test(a)?610:/fast/.test(a)?210:410}():b.showDuration+10)},_hide:function(a){var b=this,c=b.conf,d=b.$list;if(!b.state)return;b.state=!1;switch(c.hide){case"slideUp":d.slideUp(c.hideDuration);break;case"fadeOut":d.fadeOut(c.hideDuration);break;default:d.hide()}if(!a)return;setTimeout(function(){b.$view.focus()},isNaN(c.showDuration)?function(){var a=c.showDuration;return/slow/.test(a)?610:/fast/.test(a)?210:410}():c.hideDuration+10)},_change:function(a){var b=this;b.$view.find("span").text(b.map[a].text);b.$elem.val(a)},_callAPI:function(a,b){var c=this;if(typeof c[a]!="function")throw new Error(a+" does not exist of "+c.namespace+" methods.");if(/^_/.test(a)&&typeof c[a]=="function")throw new Error("Method begins with an underscore are not exposed.");return c[a](b)},refresh:function(){var a=this;a.destroy();a._build();a._eventify();a.$elem.trigger("jQselectable.refresh")},disable:function(){var a=this;a.disabled=!0;a.$view.addClass("disabled");a.$elem.trigger("jQselectable.disable")},enable:function(){var a=this;a.disabled=!1;a.$view.removeClass("disabled");a.$elem.trigger("jQselectable.enable")},destroy:function(){var a=this;a.$view.remove();a.$list.remove();a.$elem.show();a.$document.unbind("click."+a.id);a.$elem.trigger("jQselectable.destroy")}};a(c).bind({"click.jQselectable":function(b){if(!b.target)return;var c=b.target,d=c.getAttribute("data-id");b.stopPropagation();if(d&&d in e){a.each(e,function(a,b){if(a===d)return;b._hide()});return}a.each(e,function(a,b){b._hide()})},"keyup.jQselectable":function(b){if(b.keyCode!==27)return;a.each(e,function(a,b){b._hide(!0)})}});a.fn.jQselectable=function(b,c){if(!this.length)throw new Error("There is no element");if(this.length===1){var d=this.data("jQselectable");if(d)return d._callAPI(b,c);if(typeof b=="string")return;d=f(this,b);this.data("jQselectable",d);return this}a.each(this,function(){f(this,b)})}})(jQuery,this,this.document);